pipeline {
    agent any
    environment {
        TAG              = "3.0.${BUILD_NUMBER}"
        AWS_REGION       = "eu-west-2"
    }

    stages {
        stage("Release scope") {
            steps {
                script {
                    // Prepare a list and write to file
                    sh "aws s3api list-objects --bucket restless-jenkins-build  --query 'Contents[].{Key: Key}' --output text > ${WORKSPACE}/list"

                    // Load the list into a variable
                    env.LIST = readFile (file: "${WORKSPACE}/list")

                    // Show the select input
                    env.RELEASE_SCOPE = input message: 'User input required', ok: 'Release!',
                            parameters: [choice(name: 'Version', choices: env.LIST, description: 'What is the release scope?')]
                }
                echo "Release scope selected: ${env.RELEASE_SCOPE}"
            }
        }
        stage("Build") {
            steps {
                 sh '''
                 echo ${GIT_BRANCH}
                 git_branch=$(echo $GIT_BRANCH | sed -e 's/-//g' | sed -e 's/origin//g' | cut -c2-50)
                 echo $git_branch
                 touch one.txt
                 zip one.zip one.txt
                 //php build.php ${TAG} echo $git_branch
                 '''
            }
            post {
                  always {
                    archiveArtifacts artifacts: '*.zip'
                }
            }
        }
     }
}